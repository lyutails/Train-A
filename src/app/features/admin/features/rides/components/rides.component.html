<ng-container *ngIf="rideRoute">
  <form [formGroup]="rideForm" (ngSubmit)="onSubmit()">
    <div formArrayName="schedule">
      <div *ngFor="let sc of scheduleFormControl.controls; let i = index" [formGroupName]="i">
        <fieldset>
          <mat-card>
            <mat-card-header>
              <mat-card-title>Ride {{ rideRoute.schedule[i].rideId }}</mat-card-title>
            </mat-card-header>

            <div formArrayName="segments">
              <div *ngFor="let segment of sc.controls.segments.controls; let j = index" [formGroupName]="j">
                <fieldset>
                  <mat-card>
                    <mat-card-content>
                      <div class="table-container">
                        <div class="table-header">
                          <div class="table-cell">Stations</div>
                          <div class="table-cell">Price</div>
                          <div class="table-cell">Schedule</div>
                        </div>

                        <div class="table-row">
                          <div class="table-cell">{{ rideRoute.path[j] }}</div>
                          <div class="table-cell">
                            <div class="price-column">
                              <div *ngFor="let price of segment.controls.price.controls | keyvalue; let k = index">
                                <mat-form-field appearance="outline">
                                  <mat-label>{{ price.key }}</mat-label>
                                  <input matInput [formControl]="price.value" />
                                  <mat-error *ngIf="price.value.hasError('required')"> "Price is required" </mat-error>
                                  <mat-error *ngIf="price.value.hasError('pattern')">
                                    'Price is not in correct format'
                                  </mat-error>
                                </mat-form-field>
                              </div>
                            </div>
                          </div>
                          <div class="table-cell">
                            <div class="time-column">
                              <div *ngFor="let timeControl of segment.controls.time.controls; let k = index">
                                <ng-container *ngIf="j === 0 && k === 0">
                                  <mat-label> Departs </mat-label>
                                  <input type="datetime-local" matInput [formControl]="timeControl" />
                                  <mat-error *ngIf="timeControl.hasError('required')">Time is required</mat-error>
                                </ng-container>

                                <ng-container *ngIf="j > 0 && j < sc.controls.segments.controls.length - 1 && k === 1">
                                  <mat-label> Arrives </mat-label>
                                  <input type="datetime-local" matInput [formControl]="getTrainArrival(i, j)" />
                                  <mat-error *ngIf="timeControl.hasError('required')">Time is required</mat-error>
                                </ng-container>

                                <ng-container *ngIf="j > 0 && j < sc.controls.segments.controls.length - 1 && k === 0">
                                  <mat-label> Departs </mat-label>
                                  <input type="datetime-local" matInput [formControl]="timeControl" />
                                  <mat-error *ngIf="timeControl.hasError('required')">Time is required</mat-error>
                                </ng-container>

                                <ng-container *ngIf="j === sc.controls.segments.controls.length - 1 && k === 1">
                                  <mat-label> Arrives </mat-label>
                                  <input type="datetime-local" matInput [formControl]="timeControl" />
                                  <mat-error *ngIf="timeControl.hasError('required')">Time is required</mat-error>
                                </ng-container>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </mat-card-content>
                  </mat-card>
                </fieldset>
              </div>
            </div>
          </mat-card>
        </fieldset>
      </div>
    </div>
    <button mat-raised-button color="primary" type="submit">Submit</button>
  </form>
</ng-container>
